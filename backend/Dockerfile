# STAGE 1: Build the application JAR
# ğŸ”» ìˆ˜ì •ë¨: ë³´ë‹¤ ì•ˆì •ì ì¸ eclipse-temurin JDK ì´ë¯¸ì§€ ì‚¬ìš©
FROM eclipse-temurin:21-jdk-jammy AS builder

WORKDIR /app

# build.gradle íŒŒì¼ ë¨¼ì € ë³µì‚¬í•˜ì—¬ ì¢…ì†ì„± ìºì‹± í™œìš©
COPY build.gradle settings.gradle /app/
COPY gradlew /app/
COPY gradle /app/gradle/

# gradle wrapper ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
RUN chmod +x ./gradlew

# ì¢…ì†ì„± ë‹¤ìš´ë¡œë“œ (ì†ŒìŠ¤ì½”ë“œ ë³€ê²½ ì—†ì´ ì¢…ì†ì„±ë§Œ ë³€ê²½ë˜ì—ˆì„ ë•Œ ë¹Œë“œ ì‹œê°„ ë‹¨ì¶•)
RUN ./gradlew dependencies

# ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
COPY src /app/src

# Gradleì„ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
RUN ./gradlew bootJar

# STAGE 2: Create the final lean image
# ğŸ”» ìˆ˜ì •ë¨: JRE ì—­ì‹œ eclipse-temurin ì´ë¯¸ì§€ ì‚¬ìš©
FROM eclipse-temurin:21-jre-jammy

WORKDIR /app

# builder ìŠ¤í…Œì´ì§€ì—ì„œ ë¹Œë“œëœ JAR íŒŒì¼ë§Œ ë³µì‚¬
COPY --from=builder /app/build/libs/*.jar app.jar

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8080

# ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
ENTRYPOINT ["java", "-jar", "app.jar"]
